<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Creator Micro Mapper</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="app">
      <header class="app-header">
        <h1>Creator Micro Mapper</h1>
        <p>
          Configura il tuo Work Louder Creator Micro in modo semplice: scegli
          tasti con nomi leggibili, crea scorciatoie, assegna macro.
        </p>
      </header>

      <section class="panel controls-panel">
        <h2>Profile</h2>
        <div class="field-group">
          <label for="profileName">Profile Name</label>
          <input id="profileName" type="text" placeholder="My Creator Micro Profile" />
        </div>

        <div class="field-row">
          <div class="field-group">
            <label for="layerSelect">Layer</label>
            <select id="layerSelect"></select>
          </div>
          <div class="field-group">
            <label for="keyCount">Key Count</label>
            <input id="keyCount" type="number" min="1" max="64" />
          </div>
        </div>

        <div class="field-group">
          <label for="knobCount">Knob / Encoder Count</label>
          <input id="knobCount" type="number" min="1" max="2" />
        </div>
      </section>

      <section class="panel layout-panel">
        <h2>Keyboard Layout</h2>
        <p class="hint">Select a key to edit its action.</p>
        <div id="keyGrid" class="key-grid"></div>
      </section>

      <section class="panel editor-panel">
        <h2>Key Editor</h2>
        <p id="selectedKeyLabel">No key selected.</p>
        <p class="hint">
          Modalita semplice: seleziona i tasti con nomi normali. I codici VIA
          restano disponibili solo in "Avanzato".
        </p>

        <div id="keyActionFields" class="editor-section">
          <div class="field-group">
            <label for="keycodeSelect">Azione base (layout ITA)</label>
            <select id="keycodeSelect"></select>
          </div>
          <p class="hint">
            Modificatori facoltativi: se ne selezioni uno o piu, diventa una
            scorciatoia.
          </p>
          <div class="checkbox-row">
            <label><input type="checkbox" value="LCTL" class="key-modifier" />Ctrl</label>
            <label><input type="checkbox" value="LSFT" class="key-modifier" />Maiusc</label>
            <label><input type="checkbox" value="LALT" class="key-modifier" />Alt</label>
            <label><input type="checkbox" value="LGUI" class="key-modifier" />Cmd / Win</label>
          </div>
          <details class="advanced-details">
            <summary>Avanzato: codice VIA/QMK</summary>
            <div class="field-group compact">
              <label for="keycodeInput">Codice raw</label>
              <input id="keycodeInput" type="text" placeholder="KC_A" />
            </div>
          </details>
          <div class="field-group">
            <label for="keyAssignmentFriendlyPreview">Output leggibile</label>
            <input id="keyAssignmentFriendlyPreview" type="text" readonly />
          </div>
          <div class="field-group">
            <label for="keyAssignmentPreview">Codice VIA generato</label>
            <input id="keyAssignmentPreview" type="text" readonly />
          </div>
        </div>

        <div class="field-group">
          <label>
            <input id="useMacroAssignment" type="checkbox" />
            Usa macro per questo tasto
          </label>
        </div>

        <div id="macroFields" class="editor-section hidden">
          <div class="field-group">
            <label for="macroSelect">Macro</label>
            <select id="macroSelect"></select>
          </div>
        </div>
      </section>

      <section class="panel encoder-panel">
        <h2>Knobs / Encoders</h2>
        <p class="hint">
          Creator Micro: 2 manopole. Per ogni knob imposta CCW/CW con tasto
          base e modificatori. Esempio: abilita Alt + Scroll giu.
        </p>
        <div class="button-row">
          <button id="applyScrollPresetButton" type="button">
            Preset: scroll su/giu su tutti i knob
          </button>
          <button id="applyAltScrollPresetButton" type="button">
            Preset knob 2: Alt + scroll su/giu
          </button>
        </div>
        <div id="encoderList" class="encoder-list"></div>
      </section>

      <section class="panel macro-panel">
        <h2>Macros</h2>
        <p class="hint">
          Composer visuale: costruisci la macro a step (tasto, scorciatoia,
          testo, pausa) senza scrivere codici.
        </p>
        <div id="macroList" class="macro-list"></div>
        <button id="addMacroButton" type="button">Aggiungi macro</button>
      </section>

      <section class="panel output-panel">
        <h2>Export Preview</h2>
        <p class="hint">
          This JSON captures your key assignments and macros for later import.
        </p>
        <div class="button-row">
          <button id="saveLocalButton" type="button">Save Local</button>
          <button id="loadLocalButton" type="button">Load Local</button>
          <button id="resetButton" type="button" class="danger">Reset</button>
          <button id="exportButton" type="button">Export JSON</button>
          <label class="file-label" for="importInput">Import JSON</label>
          <input id="importInput" type="file" accept="application/json" />
        </div>
        <p id="statusMessage" class="status"></p>
        <textarea id="jsonPreview" readonly></textarea>
      </section>
    </main>

    <script src="./app.js"></script>
  </body>
</html>
